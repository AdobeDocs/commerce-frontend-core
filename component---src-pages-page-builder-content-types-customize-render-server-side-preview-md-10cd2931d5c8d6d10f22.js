"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[7926],{23143:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return s},default:function(){return p}});var r=n(87462),a=n(45987),o=(n(35776),n(3905)),i=n(91515);const d=["components"],s={},m={_frontmatter:s},l=i.Z;function p(e){let{components:t}=e,n=(0,a.Z)(e,d);return(0,o.mdx)(l,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"render-server-side-previews"},"Render server-side previews"),(0,o.mdx)("p",null,"This topic describes how to use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"RenderPool")," on the stage to render a backend preview."),(0,o.mdx)("p",null,"Using this method, you can preview content types that cannot be rendered on the stage and require further backend processing to be previewed."),(0,o.mdx)("p",null,"The following steps utilize some example values. Substitute those with values specific to your situation."),(0,o.mdx)("h2",{id:"step-1-create-a-renderer"},"Step 1: Create a renderer"),(0,o.mdx)("p",null,"Create a renderer that implements the renderer interface, ",(0,o.mdx)("inlineCode",{parentName:"p"},"Magento\\PageBuilder\\Model\\Stage\\RendererInterface"),":"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php"},"<?php\nnamespace Magento\\PageBuilder\\Model\\Stage\\Renderer;\n\nclass AwesomeElement implements \\Magento\\PageBuilder\\Model\\Stage\\RendererInterface\n{\n    public function render(array $params): array\n    {\n        return ['message' => 'Hello stage! You said ' . $params['message'] . '!'];\n    }\n}\n")),(0,o.mdx)("h2",{id:"step-2-add-the-renderer-to-the-pool"},"Step 2: Add the renderer to the pool"),(0,o.mdx)("p",null,"Add the renderer you just created as an argument to the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Magento\\PageBuilder\\Model\\Stage\\RendererPool")," type that specifies your custom content type role as the name in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"di.xml")," file:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<type name="Magento\\PageBuilder\\Model\\Stage\\RendererPool">\n    <arguments>\n        <argument name="renderers" xsi:type="array">\n            <item name="awesome-element" xsi:type="object">Magento\\PageBuilder\\Model\\Stage\\Renderer\\AwesomeElement</item>\n        </argument>\n    </arguments>\n</type>\n')),(0,o.mdx)("h2",{id:"step-3-submit-an-http-request-to-the-preview-controller"},"Step 3: Submit an HTTP request to the preview controller"),(0,o.mdx)("p",null,"To invoke the renderer from the stage, submit an HTTP request to the Page Builder preview controller:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Obtain the URL for the HTTP request from within your preview component by calling ",(0,o.mdx)("inlineCode",{parentName:"p"},'getConfig("preview_url")')," on the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Magento_PageBuilder/js/config")," component.")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Make a request to the aforementioned obtained URL specifying your custom content type name and any additional parameters you want to use to render the element:"),(0,o.mdx)("pre",{parentName:"li"},(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"}," define([\n     'jquery',\n     'Magento_PageBuilder/js/content-type/preview',\n     'Magento_PageBuilder/js/config'\n ], function ($, Preview, Config) {\n     var AwesomeElement = function() {\n         Preview.apply(this, arguments);\n     };\n\n     AwesomeElement.prototype = Object.create(Preview.prototype);\n     AwesomeElement.prototype.constructor = AwesomeElement;\n\n     AwesomeElement.prototype.afterObservablesUpdated = function() {\n         Preview.prototype.afterObservablesUpdated.call(this);\n         // Get the url to call\n         var url = Config.getConfig(\"preview_url\");\n         const requestConfig = {\n             method: \"POST\",\n             data: {\n                 role: this.config.name, // this would be awesome-element in this case\n                 // You can also pass any other data to the renderer\n                 message: 'custom data'\n             }\n         };\n\n         $.ajax(url, requestConfig).done(function(response) {\n             // Will display: \"Hello stage! You said custom data!\"\n             this.data.main.html(response.data.message);\n         }.bind(this));\n     };\n\n     return AwesomeElement;\n });\n")))),(0,o.mdx)("h2",{id:"step-4-render-the-element"},"Step 4: Render the element"),(0,o.mdx)("p",null,"Your exact configuration and situation determine when, and how, you render the element."),(0,o.mdx)("p",null,"Generally, you would perform this operation when the properties change, by overriding the ",(0,o.mdx)("inlineCode",{parentName:"p"},"afterObservablesUpdated")," method with this logic (as shown in the previous example)."),(0,o.mdx)("p",null,"To update the Document Object Model (DOM) to display your content, amend the JavaScript property that represents the HTML variable of your main element with the response from the HTTP request, ",(0,o.mdx)("inlineCode",{parentName:"p"},"this.data.main.html(response.data.message);")," from the previous example."))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-page-builder-content-types-customize-render-server-side-preview-md-10cd2931d5c8d6d10f22.js.map