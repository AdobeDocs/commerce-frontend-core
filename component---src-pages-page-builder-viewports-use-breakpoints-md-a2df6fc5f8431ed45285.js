"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[1231],{69579:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return s},default:function(){return l}});var a=t(87462),i=t(45987),o=(t(35776),t(3905)),r=t(91515);const d=["components"],s={},p={_frontmatter:s},m=r.Z;function l(e){let{components:n}=e,t=(0,i.Z)(e,d);return(0,o.mdx)(m,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"use-breakpoints-for-widgets"},"Use breakpoints for widgets"),(0,o.mdx)("p",null,"Using breakpoints in Page Builder involves adding custom data to a breakpoint configuration so that you can use that data to control the responsive behavior of content types from ",(0,o.mdx)("inlineCode",{parentName:"p"},"widgets"),"."),(0,o.mdx)("p",null,"The Products ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget.js")," provides a good example of why you might need to do this and how it works. Within the widget, the ",(0,o.mdx)("inlineCode",{parentName:"p"},"min-width")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"max-width")," strings are passed to a ",(0,o.mdx)("a",{parentName:"p",href:"https://www.w3schools.com/jsref/met_win_matchmedia.asp"},"matchMedia() function"),". This method creates a list of media queries created from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"min-width")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"max-width")," values from all the breakpoints defined in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"view.xml")," file. When the browser width matches one of the query breakpoints, ",(0,o.mdx)("inlineCode",{parentName:"p"},"matchMedia()")," invokes a callback function on the widget. The widget can then respond to the breakpoint by calling functions and changing configurations on other controls like the ",(0,o.mdx)("a",{parentName:"p",href:"https://kenwheeler.github.io/slick/"},"slick carousel"),"."),(0,o.mdx)("p",null,"Let's look closer at how the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Products")," content type uses data from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"view.xml")," configuration to control the number of products displayed in its carousel component at different breakpoints."),(0,o.mdx)("p",null,"All breakpoints define an ",(0,o.mdx)("inlineCode",{parentName:"p"},"options")," node for ",(0,o.mdx)("inlineCode",{parentName:"p"},"products")," as shown here in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"tablet")," breakpoint:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<var name="tablet">\n    <var name="conditions">\n        <var name="max-width">1024px</var>\n        <var name="min-width">768px</var>\n    </var>\n    <var name="options">\n        <var name="products">\n            <var name="default">\n                <var name="slidesToShow">4</var>\n            </var>\n            <var name="continuous">\n                <var name="slidesToShow">3</var>\n            </var>\n        </var>\n    </var>\n</var>\n')),(0,o.mdx)("p",null,"On the frontend, when a breakpoint is active, the Products widget gets the ",(0,o.mdx)("inlineCode",{parentName:"p"},"slidesToShow")," value defined for that breakpoint in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"view.xml")," configuration. The widget then passes that value to its internal carousel to show the number of products defined for the current breakpoint."),(0,o.mdx)("p",null,"Like other content type ",(0,o.mdx)("inlineCode",{parentName:"p"},"widgets"),", the Product's ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," is loaded on the frontend. However, the Product's ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," also needs to listen for viewport stage events (",(0,o.mdx)("inlineCode",{parentName:"p"},"stage:viewportChangeAfter"),") when the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Products")," content type is rendered inside a ",(0,o.mdx)("inlineCode",{parentName:"p"},"Block")," or ",(0,o.mdx)("inlineCode",{parentName:"p"},"Dynamic Block")," on the stage. In such cases, the ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," breakpoint functions (called on the frontend) do not work. That's why you see a frontend ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," defining a backend event handler."),(0,o.mdx)("p",null,"To capture and respond to events on the Admin stage and the frontend, you need to create two types of event handlers:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Frontend event handler using the ",(0,o.mdx)("inlineCode",{parentName:"li"},"matchMedia")," function"),(0,o.mdx)("li",{parentName:"ul"},"Stage event handler for Page Builder's ",(0,o.mdx)("inlineCode",{parentName:"li"},"stage:viewportChangeAfter")," events.")),(0,o.mdx)("h2",{id:"frontend-event-handler"},"Frontend event handler"),(0,o.mdx)("p",null,"For the frontend, use the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/paulirish/matchMedia.js/"},"matchMedia")," polyfill from ",(0,o.mdx)("inlineCode",{parentName:"p"},"lib/web/matchMedia.js"),". Adobe Commerce uses this polyfill in the Blank and Luma themes as described in ",(0,o.mdx)("a",{parentName:"p",href:"../../guide/responsive-design/js.md"},"JavaScript in Commerce responsive design"),"."),(0,o.mdx)("p",null,"The Products widget uses it as shown in this fragment:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-terminal"},"Magento/PageBuilder/view/base/web/js/content-type/products/appearance/carousel/widget.js\n")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},"define([\n    'jquery',\n    'underscore',\n    'matchMedia',\n    'Magento_PageBuilder/js/utils/breakpoints',\n    'Magento_PageBuilder/js/events',\n    'slick'\n], function ($, _, mediaCheck, breakpointsUtils, events) {\n    'use strict';\n    ///\n    return function (config, element) {\n    ///\n        _.each(config.breakpoints, function (breakpoint) {\n            mediaCheck({\n                media: breakpointsUtils.buildMedia(breakpoint.conditions),\n\n                entry: function () {\n                    initSlider($element, slickConfig, breakpoint);\n                }\n            });\n        });\n    ///\n    };\n});\n")),(0,o.mdx)("h2",{id:"stage-event-handler"},"Stage event handler"),(0,o.mdx)("p",null,"For the Admin stage, use the ",(0,o.mdx)("a",{parentName:"p",href:"../architecture/events.md#stageviewportchangeafter"},"stage:viewportChangeAfter")," event to control responsive changes to your content type from within your ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget"),"."),(0,o.mdx)("p",null,"As mentioned for the Products ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget"),", your ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," should handle this event for cases where your content type is contained within a Block or Dynamic Block. In these cases, your content type's ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget")," is loaded in the Admin, not your ",(0,o.mdx)("inlineCode",{parentName:"p"},"preview")," component."),(0,o.mdx)("p",null,"The Products content type implements the following event handler in its ",(0,o.mdx)("inlineCode",{parentName:"p"},"widget.js"),":"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-terminal"},"Magento/PageBuilder/view/base/web/js/content-type/products/appearance/carousel/widget.js\n")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-typescript"},"events.on('stage:viewportChangeAfter', function (args) {\n    var breakpoint = config.breakpoints[args.viewport];\n    initSlider($element, slickConfig, breakpoint);\n});\n")),(0,o.mdx)("p",null,"In both handlers, the event handler uses the breakpoint/viewport name to access the ",(0,o.mdx)("inlineCode",{parentName:"p"},"slidesToShow")," value, then uses that value to re-initialize the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Products")," carousel (the ",(0,o.mdx)("a",{parentName:"p",href:"https://kenwheeler.github.io/slick/"},"slick slider"),") to show a suitable number of products for the selected viewport width, when displayed on the stage."),(0,o.mdx)("p",null,"Notice how the viewport data in both event handlers is accessed using dot syntax according to the hierarchy defined in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"view.xml")," configuration file. For example, the ",(0,o.mdx)("inlineCode",{parentName:"p"},"preview.ts")," file, data for the local ",(0,o.mdx)("inlineCode",{parentName:"p"},"this.slidesToShow")," property is accessed using the viewport name from ",(0,o.mdx)("inlineCode",{parentName:"p"},"args"),", as shown here:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},"this.slidesToShow = parseFloat(viewports[args.viewport].options.products.default.slidesToShow);\n")),(0,o.mdx)("h2",{id:"summary"},"Summary"),(0,o.mdx)("p",null,"In Page Builder, breakpoints provide your content type widgets with the custom, breakpoint-specific data they need to control responsive behavior that cannot otherwise be controlled from media queries alone."))}l.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-page-builder-viewports-use-breakpoints-md-a2df6fc5f8431ed45285.js.map