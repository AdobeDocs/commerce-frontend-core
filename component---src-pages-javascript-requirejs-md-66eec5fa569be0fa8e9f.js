"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[3599],{40488:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return l},default:function(){return u}});var t,i=a(87462),o=a(63366),d=(a(15007),a(64983)),r=a(91515),m=["components"],l={},p=(t="InlineAlert",function(e){return console.warn("Component "+t+" was not imported, exported, or provided by MDXProvider as global scope"),(0,d.mdx)("div",e)}),s={_frontmatter:l},c=r.Z;function u(e){var n=e.components,a=(0,o.Z)(e,m);return(0,d.mdx)(c,(0,i.Z)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,d.mdx)("h1",{id:"requirejs-in-commerce"},"RequireJS in Commerce"),(0,d.mdx)("p",null,"This topic describes general concepts of how the ",(0,d.mdx)("a",{parentName:"p",href:"http://requirejs.org"},"RequireJS library")," is used in the application with examples. Please refer to official RequireJS documentation for in-depth explanation."),(0,d.mdx)("p",null,"RequireJS is a JavaScript file and module loader. It improves perceived page load times because it allows JavaScript to load in the background. In particular, it enables asynchronous JavaScript loading."),(0,d.mdx)("h2",{id:"configuration"},"Configuration"),(0,d.mdx)("p",null,"All configuration is done in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"requirejs-config.js")," file. It has a single root object ",(0,d.mdx)("inlineCode",{parentName:"p"},"config")," which contains the configuration options described below. All the configuration settings are optional and are used only when required. The following snippet is a sample ",(0,d.mdx)("inlineCode",{parentName:"p"},"requirejs-config.js")," describing the structure of the file. Example ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/app/code/Magento/Theme/view/base/requirejs-config.js"},(0,d.mdx)("inlineCode",{parentName:"a"},"requirejs-config.js")," file")),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"var config = {\n    map: {...},\n    paths: {...},\n    deps: [...],\n    shim: {...},\n    config: {\n        mixins: {...},\n        text: {...}\n    }\n}\n")),(0,d.mdx)("h3",{id:"map"},"map"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"map")," configuration maps (connects) any real AMD modules that calls ",(0,d.mdx)("inlineCode",{parentName:"p"},"define()"),", to the specified alias. In the snippet below, ",(0,d.mdx)("inlineCode",{parentName:"p"},"*")," means all loaded RequireJS modules can use the specified alias. The second mapping applies only in the context of ",(0,d.mdx)("inlineCode",{parentName:"p"},"Vendor_Module/js/amd-module"),". So, both types of contexts can be applied: either a global context, or a module specific context."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"map: {\n    '*': {\n        alias: 'Vendor_Module/js/complex/path/amd-module'\n    },\n    'Vendor_Module/js/amd-module': {\n        alias-two: 'Vendor_Module/js/complex/path/amd-module-two'\n    }\n}\n")),(0,d.mdx)("p",null,"Now we can use our ",(0,d.mdx)("inlineCode",{parentName:"p"},"Vendor_Module/js/complex/path/module")," using ",(0,d.mdx)("inlineCode",{parentName:"p"},"alias")," in any RequireJS module or config file without needing to type the entire path. For example, ",(0,d.mdx)("inlineCode",{parentName:"p"},"catalogAddToCart")," is mapped to ",(0,d.mdx)("inlineCode",{parentName:"p"},"Magento_Catalog/js/catalog-add-to-cart")," and can be used anywhere as a RequireJS module name. In the next example, ",(0,d.mdx)("inlineCode",{parentName:"p"},"catalogAddToCart")," is mapped to ",(0,d.mdx)("inlineCode",{parentName:"p"},"Magento_Catalog/js/catalog-add-to-cart")," only in the context of the ",(0,d.mdx)("inlineCode",{parentName:"p"},"discountCode")," module."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"map: {\n    '*': {\n        catalogAddToCart: 'Magento_Catalog/js/catalog-add-to-cart'\n    },\n    'discountCode': {\n        catalogAddToCart: 'Magento_Catalog/js/catalog-add-to-cart'\n    }\n}\n")),(0,d.mdx)(p,{variant:"success",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"You can also use the ",(0,d.mdx)("inlineCode",{parentName:"p"},"map")," configuration to override a JS module with a custom JS module. See ",(0,d.mdx)("a",{parentName:"p",href:"custom.md#replace-a-default-component"},"Custom JS component"),"."),(0,d.mdx)("h3",{id:"paths"},"paths"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"paths")," configuration, similar to ",(0,d.mdx)("inlineCode",{parentName:"p"},"map"),", is used for aliasing not just any real AMD module that calls ",(0,d.mdx)("inlineCode",{parentName:"p"},"define()"),", but also any JS file (even from a URL), HTML templates, etc. The application uses this to alias URLs and third-party libraries."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"paths: {\n    'alias': 'library/file',\n    'another-alias': 'https://some-library.com/file'\n}\n")),(0,d.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"When setting a path to an array with multiple script sources, if the first script fails to load, the next is used as a fallback."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"var config = {\n    ...\n    paths: {\n        'alias': [\n            'https://some-library.com/file',\n            'vendor_name>_<module_name>/js/file'\n        ]\n    }\n};\n")),(0,d.mdx)("p",null,"For external content, resources should be whitelisted; otherwise the application raises error notices in the browser console. See ",(0,d.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/php/development/security/content-security-policies/"},"Content Security Policies"),"."),(0,d.mdx)("p",null,"Consider the example of overwriting an HTML file in the adminhtml.\nIn this example, the ",(0,d.mdx)("inlineCode",{parentName:"p"},"max-length")," value of the text-box in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"adminhtml")," is altered. The HTML file is located at ",(0,d.mdx)("inlineCode",{parentName:"p"},"vendor/magento/module_ui/view/base/web/templates/form/element/input.html"),"."),(0,d.mdx)("ol",null,(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Create a ",(0,d.mdx)("inlineCode",{parentName:"p"},"requirejs-config.js")," file under ",(0,d.mdx)("inlineCode",{parentName:"p"},"app/code/<Vendor_Name>/<Module_Name>/view/base/")," and add the following code:"),(0,d.mdx)("pre",{parentName:"li"},(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"var config = {\n    paths: {\n        'ui/template/form/element/input': '<vendor_name>_<module_name>/template/form/element/input'\n    }\n};\n"))),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Create an ",(0,d.mdx)("inlineCode",{parentName:"p"},"input.html")," file under ",(0,d.mdx)("inlineCode",{parentName:"p"},"app/code/<Vendor_Name>/<Module_Name>/view/base/web/template/form/element/")," and copy the contents of the ",(0,d.mdx)("inlineCode",{parentName:"p"},"input.html")," file from the ",(0,d.mdx)("inlineCode",{parentName:"p"},"module_ui")," template file.")),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Change the maxlength value to ",(0,d.mdx)("inlineCode",{parentName:"p"},"512"),", which was originally set to ",(0,d.mdx)("inlineCode",{parentName:"p"},"256"),".")),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Upgrade the application:"),(0,d.mdx)("pre",{parentName:"li"},(0,d.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:upgrade\n"))),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Generate the dependency injection configuration:"),(0,d.mdx)("pre",{parentName:"li"},(0,d.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:di:compile\n"))),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"Confirm the modification by inspecting the element source code and check the ",(0,d.mdx)("inlineCode",{parentName:"p"},"maxlength")," value, which should be ",(0,d.mdx)("inlineCode",{parentName:"p"},"512")," as specified in the template."))),(0,d.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"The path for ",(0,d.mdx)("inlineCode",{parentName:"p"},"Magento_Ui/templates")," is set to be ",(0,d.mdx)("inlineCode",{parentName:"p"},"ui/template")," in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"requirejs-config.js")," module of ",(0,d.mdx)("inlineCode",{parentName:"p"},"module_ui"),", hence ",(0,d.mdx)("inlineCode",{parentName:"p"},"ui/template")," is used for specifying the path. If no paths are set, ",(0,d.mdx)("inlineCode",{parentName:"p"},"<module_name>/templates")," should be used."),(0,d.mdx)("h3",{id:"deps"},"deps"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"deps")," configuration is used to add a dependency. It can either be used directly under ",(0,d.mdx)("inlineCode",{parentName:"p"},"var config = {}")," or under a ",(0,d.mdx)("a",{parentName:"p",href:"#shim"},"shim configuration"),". Adding modules under an independent ",(0,d.mdx)("inlineCode",{parentName:"p"},"deps")," configuration will load the specified modules in all pages."),(0,d.mdx)("p",null,"In this snippet, the custom ",(0,d.mdx)("inlineCode",{parentName:"p"},"Vendor_Module/js/module")," will be loaded in all pages."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"deps: ['Vendor_Module/js/module']\n")),(0,d.mdx)("h3",{id:"shim"},"shim"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"shim")," configuration is used to build a dependency on a third party library, since we cannot modify it."),(0,d.mdx)("p",null,"When to use the ",(0,d.mdx)("inlineCode",{parentName:"p"},"shim")," configuration:"),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"To add a new dependency to a third party library"),(0,d.mdx)("li",{parentName:"ul"},"To add a new dependency to a third party library which does not use an AMD module"),(0,d.mdx)("li",{parentName:"ul"},"To change load order by adding a dependency to a third party library")),(0,d.mdx)("p",null,"In this snippet, dependencies are added directly in an array, or it can be specified as an array under the ",(0,d.mdx)("inlineCode",{parentName:"p"},"deps")," key. The ",(0,d.mdx)("inlineCode",{parentName:"p"},"exports")," key is used to specify under what identifier the module is exported into. This export identifier can be used to access it."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"shim: {\n    '3rd-party-library': ['myJSFile'],\n    'another-3rd-party-library': {\n        deps: ['myJSFile'],\n        exports: 'another3rdPartyLibrary'\n    }\n}\n")),(0,d.mdx)("h3",{id:"mixins"},"mixins"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"mixins")," configuration is used to overwrite component methods of an AMD module which returns either a UI component, a jQuery widget, or a JS object. Unlike the above configuration properties, the ",(0,d.mdx)("inlineCode",{parentName:"p"},"mixins")," property is under the ",(0,d.mdx)("inlineCode",{parentName:"p"},"config")," property, apart from the parent object called ",(0,d.mdx)("strong",{parentName:"p"},"config"),"."),(0,d.mdx)("p",null,"In this snippet, ",(0,d.mdx)("inlineCode",{parentName:"p"},"Vendor_Module/js/module-mixin")," will overwrite the existing component methods in ",(0,d.mdx)("inlineCode",{parentName:"p"},"Vendor_Module/js/module")," with the specified component methods. It is a convention to name the mixin by appending a ",(0,d.mdx)("inlineCode",{parentName:"p"},"-mixin")," to the original ",(0,d.mdx)("inlineCode",{parentName:"p"},"path/to/js"),", although not required."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"config: {\n    mixins: {\n        'Vendor_Module/js/module': {\n            'Vendor_Module/js/module-mixin': true\n        }\n    }\n}\n")),(0,d.mdx)("p",null,"The concept of Javascript mixins itself is explained in depth in ",(0,d.mdx)("a",{parentName:"p",href:"mixins.md"},"Using Javascript Mixins"),"."),(0,d.mdx)("h3",{id:"text"},"text"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"text")," configuration is used to set the security request headers using the ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/lib/web/mage/requirejs/text.js"},(0,d.mdx)("inlineCode",{parentName:"a"},"text.js"))," file."),(0,d.mdx)("p",null,"Without ",(0,d.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing"},"Cross Origin Resource Sharing (CORS)")," it is not possible to add the ",(0,d.mdx)("inlineCode",{parentName:"p"},"X-Requested-With")," header to a cross domain XHR request. Set this header to tell the server that the request was initiated from the same domain."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-javascript"},"config: {\n    text: {\n        'headers': {\n            'X-Requested-With': 'XMLHttpRequest'\n        }\n    }\n}\n")))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-javascript-requirejs-md-66eec5fa569be0fa8e9f.js.map