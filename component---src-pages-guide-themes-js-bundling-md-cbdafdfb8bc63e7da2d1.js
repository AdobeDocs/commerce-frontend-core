"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[9837],{64769:function(e,t,i){i.r(t),i.d(t,{_frontmatter:function(){return r},default:function(){return c}});var n=i(87462),a=i(45987),m=(i(35776),i(3905)),o=i(91515);const l=["components"],r={},s=(d="InlineAlert",function(e){return console.warn("Component "+d+" was not imported, exported, or provided by MDXProvider as global scope"),(0,m.mdx)("div",e)});var d;const p={_frontmatter:r},u=o.Z;function c(e){let{components:t}=e,i=(0,a.Z)(e,l);return(0,m.mdx)(u,(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,m.mdx)("h1",{id:"javascript-bundling"},"JavaScript bundling"),(0,m.mdx)("p",null,"JavaScript bundling is an optimization technique you can use to reduce the number of server requests for JavaScript files.\nBundling accomplishes this by merging multiple JavaScript files together into one file to reduce the number of page requests."),(0,m.mdx)("h2",{id:"enable-bundling"},"Enable bundling"),(0,m.mdx)(s,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,m.mdx)("p",null,"JavaScript bundling does not work unless the application is in ",(0,m.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/setup/application-modes.html#production-mode"},"production mode"),". Once in production mode, JavaScript bundling can only be enabled using the CLI. Follow these steps to setup JavaScript bundling from the CLI."),(0,m.mdx)("ol",null,(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"From the installation directory, switch to production mode:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento deploy:mode:set production\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"Enable JavaScript bundling:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set dev/js/enable_js_bundling 1\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"Optimize bundling by minifying JavaScript files:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set dev/js/minify_files 1\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"Enable cache busting on static file URLs. This ensures users get the latest version of the assets anytime they update:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set dev/static/sign 1\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"To configure JavaScript bundling, you must disable Javascript file merging. Bundling will not work as the merging of files excludes bundling:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set dev/js/merge_files 0\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"Modifying the settings above when the application is in production mode will require ",(0,m.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/static-view/static-view-file-deployment.html"},"static view files deployment"),":"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:static-content:deploy\n"))),(0,m.mdx)("li",{parentName:"ol"},(0,m.mdx)("p",{parentName:"li"},"Finally, clear the cache:"),(0,m.mdx)("pre",{parentName:"li"},(0,m.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento cache:clean config\n")),(0,m.mdx)("p",{parentName:"li"},"For example, when ",(0,m.mdx)("inlineCode",{parentName:"p"},"Sign Static Files")," is disabled (which is the default: ",(0,m.mdx)("inlineCode",{parentName:"p"},"config:set dev/static/sign 0"),"), the URL to a static file might look like this: ",(0,m.mdx)("inlineCode",{parentName:"p"},"/static/frontend/Magento/luma/en_US/mage/dataPost.js"),". But when you enable the setting (",(0,m.mdx)("inlineCode",{parentName:"p"},"config:set dev/static/sign 1"),"), the same URL might look something like this: ",(0,m.mdx)("inlineCode",{parentName:"p"},"static/version40s2f9ef/frontend/Magento/luma/en_US/mage/dataPost.js"),", with a version number added as shown. The next time this file is updated (with ",(0,m.mdx)("inlineCode",{parentName:"p"},"bin/magento setup:static-content:deploy"),"), a new version will be generated, causing the browser to download a new file from the server, thus busting the browser's cache."))),(0,m.mdx)("h2",{id:"how-bundling-works"},"How bundling works"),(0,m.mdx)("p",null,"When you enable bundling, the application combines hundreds of JavaScript files into just a few JavaScript bundles and downloads those bundles for each page. Because the browser downloads the bundles synchronously, page rendering is blocked until all bundles finish downloading. But the time saved from reducing server requests from hundreds to just a few, usually offsets the cost of downloading the bundles synchronously."),(0,m.mdx)("h3",{id:"excluding-files"},"Excluding files"),(0,m.mdx)("p",null,"The ",(0,m.mdx)("inlineCode",{parentName:"p"},"<exclude>")," node in the ",(0,m.mdx)("inlineCode",{parentName:"p"},"etc/view.xml")," file for a theme specifies the files to exclude from the JavaScript bundling process.\nJavaScript files excluded from bundling are loaded asynchronously by RequireJS as needed."),(0,m.mdx)("p",null,"As such, you should exclude the JavaScript files you use for testing or development so that they are not loaded on every page."),(0,m.mdx)("p",null,"The following code snippet from ",(0,m.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/app/design/frontend/Magento/luma/etc/view.xml#L270"},"Luma theme")," shows the types of files you should exclude from the bundling process."),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-xml"},'<exclude>\n    <item type="file">Lib::jquery/jquery.min.js</item>\n    <item type="file">Lib::jquery/jquery-ui-1.9.2.js</item>\n    <item type="file">Lib::jquery/jquery.ba-hashchange.min.js</item>\n    <item type="file">Lib::jquery/jquery.details.js</item>\n    <item type="file">Lib::jquery/jquery.details.min.js</item>\n    <item type="file">Lib::jquery/jquery.hoverIntent.js</item>\n    <item type="file">Lib::jquery/colorpicker/js/colorpicker.js</item>\n    <item type="file">Lib::requirejs/require.js</item>\n    <item type="file">Lib::requirejs/text.js</item>\n    <item type="file">Lib::date-format-normalizer.js</item>\n    <item type="file">Lib::legacy-build.min.js</item>\n    <item type="file">Lib::mage/captcha.js</item>\n    <item type="file">Lib::mage/dropdown_old.js</item>\n    <item type="file">Lib::mage/list.js</item>\n    <item type="file">Lib::mage/loader_old.js</item>\n    <item type="file">Lib::mage/webapi.js</item>\n    <item type="file">Lib::mage/zoom.js</item>\n    <item type="file">Lib::mage/translate-inline-vde.js</item>\n    <item type="file">Lib::mage/requirejs/mixins.js</item>\n    <item type="file">Lib::mage/requirejs/static.js</item>\n    <item type="file">Magento_Customer::js/zxcvbn.js</item>\n    <item type="file">Magento_Catalog::js/zoom.js</item>\n    <item type="file">Magento_Ui::js/lib/step-wizard.js</item>\n    <item type="file">Magento_Ui::js/form/element/ui-select.js</item>\n    <item type="file">Magento_Ui::js/form/element/file-uploader.js</item>\n    <item type="file">Magento_Ui::js/form/components/insert.js</item>\n    <item type="file">Magento_Ui::js/form/components/insert-listing.js</item>\n    <item type="directory">Magento_Ui::js/timeline</item>\n    <item type="directory">Magento_Ui::js/grid</item>\n    <item type="directory">Magento_Ui::js/dynamic-rows</item>\n    <item type="directory">Magento_Ui::templates/timeline</item>\n    <item type="directory">Magento_Ui::templates/grid</item>\n    <item type="directory">Magento_Ui::templates/dynamic-rows</item>\n    <item type="directory">Magento_Swagger::swagger-ui</item>\n    <item type="directory">Lib::modernizr</item>\n    <item type="directory">Lib::tiny_mce</item>\n    <item type="directory">Lib::varien</item>\n    <item type="directory">Lib::jquery/editableMultiselect</item>\n    <item type="directory">Lib::jquery/jstree</item>\n    <item type="directory">Lib::jquery/fileUploader</item>\n    <item type="directory">Lib::css</item>\n    <item type="directory">Lib::lib</item>\n    <item type="directory">Lib::extjs</item>\n    <item type="directory">Lib::prototype</item>\n    <item type="directory">Lib::scriptaculous</item>\n    <item type="directory">Lib::less</item>\n    <item type="directory">Lib::mage/adminhtml</item>\n    <item type="directory">Lib::mage/backend</item>\n</exclude>\n')),(0,m.mdx)("h3",{id:"setting-bundle-file-size"},"Setting bundle file size"),(0,m.mdx)("p",null,"The ",(0,m.mdx)("inlineCode",{parentName:"p"},"bundle_size")," variable controls the file size of the generated bundles.\nSpecifying a large ",(0,m.mdx)("inlineCode",{parentName:"p"},"bundle_size")," reduces the number of bundles generated, but generates larger file sizes.\nSpecifying a smaller ",(0,m.mdx)("inlineCode",{parentName:"p"},"bundle_size")," generates more bundles with a smaller file sizes."),(0,m.mdx)("p",null,"Example:"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-xml"},'<vars module="Js_Bundle">\n    <var name="bundle_size">1MB</var>\n</vars>\n')),(0,m.mdx)("p",null,"The goal is to balance the number of bundles to download with the size of each bundle.\nAs a rule of thumb, each bundle should be at least 100 kB."),(0,m.mdx)("h2",{id:"fine-tuning-your-theme"},"Fine-tuning your theme"),(0,m.mdx)("p",null,"There are many ways to tune your theme using the ",(0,m.mdx)("inlineCode",{parentName:"p"},"etc/view.xml")," file."),(0,m.mdx)("p",null,"For example, the Luma theme is configured to work well for all pages, but you can maximize browser performance for home, catalog, or product pages by adding items to or removing items from the ",(0,m.mdx)("inlineCode",{parentName:"p"},"<exclude>")," node."),(0,m.mdx)("p",null,"Follow these steps to help you identify which JavaScript files to bundle for your theme:"),(0,m.mdx)("ol",null,(0,m.mdx)("li",{parentName:"ol"},"Create a blank page with the layouts you would like to tune."),(0,m.mdx)("li",{parentName:"ol"},"Compare the JavaScript files loaded in the pages with the JavaScript files."),(0,m.mdx)("li",{parentName:"ol"},"Use the results of that comparison to build your exclude list.")))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guide-themes-js-bundling-md-cbdafdfb8bc63e7da2d1.js.map