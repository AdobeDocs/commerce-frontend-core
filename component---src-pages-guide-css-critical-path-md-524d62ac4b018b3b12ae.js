"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[8962],{38418:function(e,t,i){i.r(t),i.d(t,{_frontmatter:function(){return o},default:function(){return b}});var a=i(87462),n=i(45987),r=(i(35776),i(3905)),c=i(91515);const s=["components"],o={},m=(d="InlineAlert",function(e){return console.warn("Component "+d+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)});var d;const p={_frontmatter:o},l=c.Z;function b(e){let{components:t}=e,i=(0,n.Z)(e,s);return(0,r.mdx)(l,(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"css-critical-path"},"CSS critical path"),(0,r.mdx)("p",null,"All CSS styles loaded from external files are considered as render-blocking. This means that a web page will not be displayed until these files are loaded.\nBy using 'CSS critical path', we deliver minified critical CSS inline in ",(0,r.mdx)("inlineCode",{parentName:"p"},"<head>")," and defer all non-critical styles that are loaded asynchronously.\nThus we can significantly improve the time to first render of our pages."),(0,r.mdx)("h2",{id:"enable-css-critical-path"},"Enable CSS critical path"),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"CSS critical path configuration is located on the ",(0,r.mdx)("strong",{parentName:"p"},"Stores")," > Settings > ",(0,r.mdx)("strong",{parentName:"p"},"Configuration")," > ",(0,r.mdx)("strong",{parentName:"p"},"ADVANCED")," > ",(0,r.mdx)("strong",{parentName:"p"},"Developer")," tab. However, the ",(0,r.mdx)("strong",{parentName:"p"},"Developer")," tab is hidden in ",(0,r.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/setup/application-modes.html"},"production mode"),". Once in production mode, CSS critical path can only be enabled using the CLI."),(0,r.mdx)("p",null,"To enable the CSS critical path:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento config:set dev/css/use_css_critical_path 1\n")),(0,r.mdx)("p",null,"Make sure that there is a ",(0,r.mdx)("inlineCode",{parentName:"p"},"critical.css")," file for your theme. Other non-critical CSS files will be loaded asynchronously."),(0,r.mdx)("h2",{id:"overview"},"Overview"),(0,r.mdx)("p",null,"The 'critical' CSS file should be located in ",(0,r.mdx)("inlineCode",{parentName:"p"},"app/design/frontend/<your_vendor_name>/<your_theme_name>/web/css/critical.css"),"\nThe default Luma theme critical CSS file is located in ",(0,r.mdx)("inlineCode",{parentName:"p"},"app/design/frontend/Magento/luma/web/css/critical.css"),"\nIf there is not a ",(0,r.mdx)("inlineCode",{parentName:"p"},"critical.css")," file for the custom theme, but there is one for the Luma theme, Luma's ",(0,r.mdx)("inlineCode",{parentName:"p"},"critical.css")," will be used.\nThe critical css file path can also be configured in ",(0,r.mdx)("inlineCode",{parentName:"p"},"di.xml")," as a constructor ",(0,r.mdx)("inlineCode",{parentName:"p"},"filePath")," argument in the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Theme\\Block\\Html\\Header\\CriticalCss")," block."),(0,r.mdx)("p",null,"To generate a critical CSS for your theme, critical path CSS generators like ",(0,r.mdx)("a",{parentName:"p",href:"https://www.npmjs.com/package/penthouse"},"Penthouse")," or ",(0,r.mdx)("a",{parentName:"p",href:"https://www.npmjs.com/package/critical"},"Critical")," can be used, or you can create it yourself. While creating critical CSS, adhere to the following principles:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Minify your ",(0,r.mdx)("inlineCode",{parentName:"li"},"critical.css")," to reduce its size."),(0,r.mdx)("li",{parentName:"ul"},"Do not duplicate styles in ",(0,r.mdx)("inlineCode",{parentName:"li"},"critical.css")," and non-critical style sheets."),(0,r.mdx)("li",{parentName:"ul"},"Do not introduce new styles in ",(0,r.mdx)("inlineCode",{parentName:"li"},"critical.css")," that are not present in non-critical style sheets. CSS rules from non-critical style sheets should overwrite critical CSS rules. Otherwise your styles can be broken.")),(0,r.mdx)("h3",{id:"critical-css-loader"},"Critical CSS loader"),(0,r.mdx)("p",null,"If 'CSS critical path' is enabled in the configuration, a preloading spinner will be used. It is added in ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento/Theme/view/frontend/layout/default.xml"),".\nAfter non-critical CSS is loaded and applied, the spinner disappears. The spinner will disappear automatically only if you have CSS styles from the 'Blank' theme CSS. If you have your own CSS rules, you should hide the preloader by using the ",(0,r.mdx)("inlineCode",{parentName:"p"},"data-role='main-css-loader'")," attribute."),(0,r.mdx)("h2",{id:"critical-css-performance-improvements"},"Critical CSS performance improvements"),(0,r.mdx)("p",null,"Introducing a critical path CSS leads to performance improvements:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"Eliminated render-blocking CSS resources. As a result, the time for loading render-blocking resources decreases substantially."),(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,r.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"11.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,r.mdx)("picture",{parentName:"span"},"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/5530d/critical_css_improvements1.webp 320w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/0c8fb/critical_css_improvements1.webp 640w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/94b1e/critical_css_improvements1.webp 1280w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/48c97/critical_css_improvements1.webp 1326w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/dd4a7/critical_css_improvements1.png 320w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/0f09e/critical_css_improvements1.png 640w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/bbbf7/critical_css_improvements1.png 1280w","/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/329d6/critical_css_improvements1.png 1326w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,r.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/commerce-frontend-core/static/0ecd6d69b7b596e2f0355bf99737b66c/bbbf7/critical_css_improvements1.png",alt:"CSS resources eliminated as render-blocking",title:"CSS resources eliminated as render-blocking",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    "))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"The first meaningful paint time improved from 3.5 seconds to 2.3 seconds."),(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"708px"}},"\n      ",(0,r.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"20.9375%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,r.mdx)("picture",{parentName:"span"},"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/5530d/critical_css_improvements2.webp 320w","/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/0c8fb/critical_css_improvements2.webp 640w","/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/cc093/critical_css_improvements2.webp 708w"],sizes:"(max-width: 708px) 100vw, 708px",type:"image/webp"}),"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/dd4a7/critical_css_improvements2.png 320w","/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/0f09e/critical_css_improvements2.png 640w","/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/d65de/critical_css_improvements2.png 708w"],sizes:"(max-width: 708px) 100vw, 708px",type:"image/png"}),"\n          ",(0,r.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/commerce-frontend-core/static/e89f1167d59b39645d8ad7b8292bd58e/d65de/critical_css_improvements2.png",alt:"First meaningful paint time improved",title:"First meaningful paint time improved",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    "))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"The speed index increased by 0.8 seconds."),(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"626px"}},"\n      ",(0,r.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"23.75%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,r.mdx)("picture",{parentName:"span"},"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/3f3b65f1c5f0dc583c7e850b673624d4/5530d/critical_css_improvements3.webp 320w","/commerce-frontend-core/static/3f3b65f1c5f0dc583c7e850b673624d4/ec4d5/critical_css_improvements3.webp 626w"],sizes:"(max-width: 626px) 100vw, 626px",type:"image/webp"}),"\n          ",(0,r.mdx)("source",{parentName:"picture",srcSet:["/commerce-frontend-core/static/3f3b65f1c5f0dc583c7e850b673624d4/dd4a7/critical_css_improvements3.png 320w","/commerce-frontend-core/static/3f3b65f1c5f0dc583c7e850b673624d4/ce661/critical_css_improvements3.png 626w"],sizes:"(max-width: 626px) 100vw, 626px",type:"image/png"}),"\n          ",(0,r.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/commerce-frontend-core/static/3f3b65f1c5f0dc583c7e850b673624d4/ce661/critical_css_improvements3.png",alt:"Speed index increased",title:"Speed index increased",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")))),(0,r.mdx)("p",null,"As a result, the Google PageSpeed Insights score improved by ",(0,r.mdx)("strong",{parentName:"p"},"5")," points."),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"These are results for mobile devices with slow connection from ",(0,r.mdx)("a",{parentName:"p",href:"https://developers.google.com/speed/pagespeed/insights/"},"Google PageSpeed Insights"),"."))}b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guide-css-critical-path-md-524d62ac4b018b3b12ae.js.map